package me.pluie.aoc

const val OCR_WIDTH = 4
const val OCR_HEIGHT = 6

fun BitGrid.ocr(): String = xRange.step(OCR_WIDTH + 1).toS().m {
    val n = (0 until OCR_HEIGHT).fold(0) { acc, y ->
        acc shl 4 or (0 until OCR_WIDTH).fold(0) { a, x ->
            a shl 1 or if (this[x + it, y]) 1 else 0
        }
    }
    recognize(n)
}.join()

private fun recognize(n: Int): Char = when(n) {
    0b0110_1001_1001_1111_1001_1001 -> 'A'
    0b1110_1001_1110_1001_1001_1110 -> 'B'
//  0b1111_1111_1111_1111_1111_1111 -> 'C'
//  0b1111_1111_1111_1111_1111_1111 -> 'D'
    0b1111_1000_1110_1000_1000_1111 -> 'E'
    0b1111_1000_1110_1000_1000_1000 -> 'F'
    0b0110_1001_1000_1011_1001_0111 -> 'G'
    0b1001_1001_1111_1001_1001_1001 -> 'H'
    0b0011_0001_0001_0001_1001_0110 -> 'J'
    0b1001_1010_1100_1010_1010_1001 -> 'K'
    0b1000_1000_1000_1000_1000_1111 -> 'L'
//  0b1111_1111_1111_1111_1111_1111 -> 'M'
//  0b1111_1111_1111_1111_1111_1111 -> 'N'
//  0b1111_1111_1111_1111_1111_1111 -> 'O'
    0b1110_1001_1001_1110_1000_1000 -> 'P'
//  0b1111_1111_1111_1111_1111_1111 -> 'Q'
    0b1110_1001_1001_1110_1010_1001 -> 'R'
//  0b1111_1111_1111_1111_1111_1111 -> 'S'
//  0b1111_1111_1111_1111_1111_1111 -> 'T'
//  0b1111_1111_1111_1111_1111_1111 -> 'U'
//  0b1111_1111_1111_1111_1111_1111 -> 'V'
//  0b1111_1111_1111_1111_1111_1111 -> 'W'
//  0b1111_1111_1111_1111_1111_1111 -> 'X'
//  0b1111_1111_1111_1111_1111_1111 -> 'Y'
    0b1111_0001_0010_0100_1000_1111 -> 'Z'
    else -> '?'
}